<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Astone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Astone">
<meta property="og:url" content="http://astone.space/page/7/index.html">
<meta property="og:site_name" content="Astone">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Astone">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Astone" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/img/avatar.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Astone</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Keep It Simple, Stupid.</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>

					

					
					<p class="header-subtitle">caliburn_marco@163.com</p>
					

					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>

				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/TCP/" style="font-size: 18.57px;">TCP</a> <a href="/tags/algorithm/" style="font-size: 15.71px;">algorithm</a> <a href="/tags/asm/" style="font-size: 15.71px;">asm</a> <a href="/tags/elk/" style="font-size: 10px;">elk</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/linux/" style="font-size: 14.29px;">linux</a> <a href="/tags/lua/" style="font-size: 20px;">lua</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/note/" style="font-size: 17.14px;">note</a> <a href="/tags/python/" style="font-size: 12.86px;">python</a> <a href="/tags/unix/" style="font-size: 11.43px;">unix</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Astone</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img src="/img/avatar.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Astone</h1>
			</hgroup>
			
			<p class="header-subtitle">Keep It Simple, Stupid.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-TCP 协议分析/TCP 协议分析--TIME_WAIT 状态" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/23/TCP 协议分析/TCP 协议分析--TIME_WAIT 状态/" class="article-date">
  	<time datetime="2016-09-23T04:28:00.000Z" itemprop="datePublished">2016-09-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/23/TCP 协议分析/TCP 协议分析--TIME_WAIT 状态/">TCP 协议分析--TIME_WAIT 状态</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="TIME-WAIT"><a href="#TIME-WAIT" class="headerlink" title="TIME_WAIT"></a><strong>TIME_WAIT</strong></h3><p>　　<code>TIME_WAIT</code>是<strong>主动关闭</strong>连接的一端在释放资源之前的状态. 当 TCP 执行一个主动关闭, 在双方都完成<code>socket</code>的关闭后, 会进入<code>TIME_WAIT</code>状态. 等待2倍的 <a href="https://en.wikipedia.org/wiki/Maximum_segment_lifetime">MSL</a>, 通常是 1~4 分钟. 这是为了确保有足够的时间让对端收到<code>ACK</code>, 如果被动关闭的那方没有收到<code>ACK</code>, 就会触发被动端重发<code>FIN</code>, 一来一去正好2MSL. 同时也保证了所有关于这个连接的包在网络上消逝, 让这个连接不会跟后面的新连接混在一起. 在连接处于 2MSL 等待时，任何迟到的报文段将被丢弃. 如果马上调用 <code>bind</code>会导致<code>bind</code>失败.</p>
<h3 id="哪些场景-TIME-WAIT-会让你头疼"><a href="#哪些场景-TIME-WAIT-会让你头疼" class="headerlink" title="哪些场景 TIME_WAIT 会让你头疼 ?"></a><strong>哪些场景 TIME_WAIT 会让你头疼 ?</strong></h3><blockquote>
<ul>
<li>大量短连接访问</li>
<li>服务快速重启</li>
</ul>
</blockquote>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TCP/">TCP</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/TCP-协议分析/">TCP 协议分析</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2016/09/23/TCP 协议分析/TCP 协议分析--TIME_WAIT 状态/#more">more</a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-TCP 协议分析/TCP 协议分析--流模式" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/21/TCP 协议分析/TCP 协议分析--流模式/" class="article-date">
  	<time datetime="2016-09-21T12:23:00.000Z" itemprop="datePublished">2016-09-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/21/TCP 协议分析/TCP 协议分析--流模式/">TCP 协议分析--流模式</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a><strong>Stream</strong></h3><p>　　TCP 是流模式协议. 所谓流模式就是将传输的数据看成连续的. 例如当 send 发送 10K 的数据时, TCP 会根据 MSS 分成许多 TCP 包. 而在接收的时候我们可能需要 recv 多次才能接收一个完整的上层协议包. 另外, 当我们连续 send 两个小包时, TCP 有可能只发送了一个 TCP 包. 而当我们接收时只调用了一次 recv 就接收了两个包的数据. TCP 通过 Seq 来保证 Segment 的顺序.</p>
<h3 id="Datagram"><a href="#Datagram" class="headerlink" title="Datagram"></a><strong>Datagram</strong></h3><p>　　UDP 是数据报协议. 所谓数据报就是数据看成独立的报文. 例如当 sendto 发送数据时, UDP 不会对数据进行拆分, 而是完整的发送一个 UDP 数据报. 在 recvfrom 的时候也只会收到一次单独的数据报. UDP 并不保证数据报到达的顺序性和可靠性.</p>
<p>　　TCP 之所以能够使用流模式是因为它是一个全双工面向连接的协议–只有一个对端. 而 UDP 允许有多个对端, 多个对端之间无法协调序号, 接收方无法进行组合, 所以采用数据报的形式.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TCP/">TCP</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/TCP-协议分析/">TCP 协议分析</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Linux 工程管理工具--CMake(二)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/28/Linux/Linux 工程管理工具--CMake(二)/" class="article-date">
  	<time datetime="2016-06-28T09:33:00.000Z" itemprop="datePublished">2016-06-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/28/Linux/Linux 工程管理工具--CMake(二)/">Linux 工程管理工具--CMake(二)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a><strong>简介</strong></h3><p>　　在上文中介绍了 CMake 的样例工程. 在实际的项目中可能有各种不同的需求. CMake 提供了一些预定义变量、辅助函数等用于帮助开发者更好的使用 CMake. 下面就将 CMake 中常用的预定义变量, 以及辅助函数进行简单的介绍方便以后查阅.</p>
<h3 id="CMake-预定义变量"><a href="#CMake-预定义变量" class="headerlink" title="CMake 预定义变量"></a><strong>CMake 预定义变量</strong></h3><table>
<thead>
<tr>
<th>变量名　　　　　　　　　　　　　　　　　</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>PROJECT_NAME</td>
<td>PROJECT 命令指定的项目名</td>
</tr>
<tr>
<td>PROJECT_SOURCE_DIR</td>
<td>PROJECT 命令的 CMakeLists.txt 所在的目录</td>
</tr>
<tr>
<td>PROJECT_BINARY_DIR</td>
<td>运行 cmake 命令的目录</td>
</tr>
<tr>
<td>CMAKE_ROOT</td>
<td>CMake 模块和文件目录</td>
</tr>
<tr>
<td>CMAKE_MODULE_PATH</td>
<td>CMake INCLUDE 模块时的搜索路径</td>
</tr>
<tr>
<td>CMAKE_INCLUDE_PATH</td>
<td>编译时 include 所包含的目录</td>
</tr>
<tr>
<td>CMAKE_LIBRARY_PATH</td>
<td>链接时 lib 所包含的目录</td>
</tr>
<tr>
<td>CMAKE_CURRENT_SOURCE_DIR</td>
<td>当前 CMakeLists.txt 所在的目录</td>
</tr>
<tr>
<td>CMAKE_CURRENT_BINARY_DIR</td>
<td>当前 CMakeLists.txt obj 的输出目录</td>
</tr>
<tr>
<td>CMAKE_CURRENT_LIST_FILE</td>
<td>当前 CMakeLists.txt 的完整路径</td>
</tr>
<tr>
<td>CMAKE_CURRENT_LIST_LINE</td>
<td>当前 CMakeLists.txt 的当前行号</td>
</tr>
<tr>
<td>CMAKE_SYSTEM</td>
<td>系统信息 eg. Linux-2.6.32-573.7.1.el6.x86_64</td>
</tr>
<tr>
<td>CMAKE_SYSTEM_NAME</td>
<td>系统名称 eg. Linux</td>
</tr>
<tr>
<td>CMAKE_SYSTEM_VERSION</td>
<td>系统版本 eg. 2.6.32-573.7.1.el6.x86_64</td>
</tr>
<tr>
<td>CMAKE_SYSTEM_PROCESSOR</td>
<td>处理器架构 eg. x86_64</td>
</tr>
<tr>
<td>UNIX</td>
<td>在所有类 UNIX 平台为 TRUE</td>
</tr>
<tr>
<td>WIN32</td>
<td>在 Win32 平台为 TRUE</td>
</tr>
<tr>
<td>CMAKE_C_COMPLIER</td>
<td>C 编译器</td>
</tr>
<tr>
<td>CMAKE_CXX_COMPLIER</td>
<td>C++ 编译器</td>
</tr>
<tr>
<td>CMAKE_C_FLAGS</td>
<td>C 编译选项</td>
</tr>
<tr>
<td>CMAKE_CXX_FLAGS</td>
<td>C++ 编译选项</td>
</tr>
<tr>
<td>CMAKE_BUILD_TYPE</td>
<td>与编译选项匹配的额外编译选项. eg. DEBUG</td>
</tr>
<tr>
<td>CMAKE_CXX_FLAGS_DEBUG</td>
<td>C++ DEBUG 版本额外编译选项</td>
</tr>
<tr>
<td>CMAKE_CXX_FLAGS_RELEASE</td>
<td>C++ RELEASE 版本额外编译选项</td>
</tr>
<tr>
<td>EXECUTABLE_OUTPUT_PATH</td>
<td>可执行文件的输出目录</td>
</tr>
<tr>
<td>LIBRARY_OUTPUT_PATH</td>
<td>库文件的输出目录</td>
</tr>
</tbody>
</table>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/06/28/Linux/Linux 工程管理工具--CMake(二)/#more">more</a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Linux 工程管理工具--CMake(一)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/25/Linux/Linux 工程管理工具--CMake(一)/" class="article-date">
  	<time datetime="2016-06-25T09:28:00.000Z" itemprop="datePublished">2016-06-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/25/Linux/Linux 工程管理工具--CMake(一)/">Linux 工程管理工具--CMake(一)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a><strong>CMake</strong></h3><p>　　<a href="http://www.cmake.org">CMake</a> 是一个开源的、跨平台的、用于构建项目、单元测试、集成打包的工具集。在 Linux 下基本上都是使用 Make 来管理工程。但 Make 种类繁多：GNU Make、qmake、nmake 等等。CMake 允许开发者编写一种平台无关的 CMakeList.txt 文件来定制整个编译流程，然后再根据目标用户的平台进一步生成所需的本地化 Makefile 和工程文件。同时 CMake 可以将单元测试和打包的工作也集成到一起。</p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a><strong>优势</strong></h3><p>　　Makefile 就像语言中的 C，而 CMake 就像 python 之类的脚本语言。虽然使用更加底层的语言能够对细节把控的更好，同时也带来了实现上的复杂性。例如，通常我们的 Makefile 中依赖 <code>.c</code> <code>.cpp</code> 文件而不包含 <code>.h</code> 文件，当我们改变了 <code>.h</code> 时并不会触发过期，也就不会进行相应文件的重新编译。要想使用 Makefile 实现这个功能就需要用 <code>gcc -MM</code> 生成所有头文件相关的依赖，然后为这些文件在 Makefile 中建立正确的依赖。还有类似生成静态库，动态库等不是很常用的编译选项都增加了无谓的成本。而使用 CMake 它会默默的帮你搞定这些细节。<br>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/06/25/Linux/Linux 工程管理工具--CMake(一)/#more">more</a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Note/近期学习规划" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/13/Note/近期学习规划/" class="article-date">
  	<time datetime="2016-06-13T15:12:00.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/Note/近期学习规划/">近期学习规划</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>　　最近回顾了 TCP 协议的要点、汇编入门、学习 lua 和 lua 源代码、学习 skynet 框架、用 python 做了一些小工具。虽然学习的内容有些杂乱，不过都是用于降低学习曲线的基础知识。目的是为了实现搭积木一样的游戏服务器框架。用框架提供的 API 编写出各种服务，将各种服务组合成游戏服务。<br>　　首先参考了云大的 skynet 框架。skynet 使用 lua 作为辅助开发语言，需要对 lua 比较熟悉。于是开始学习 lua，lua 的指令执行类似于汇编，同时 lua 与 C 语言交互是通过栈来实现的。学习汇编能够降低学习曲线。至于 TCP 协议，作为服务框架自然是必不可少的。于是就形成了上面的学习流程。<br>　　后面的学习主要在实现 gateway_server 然后从 gateway_server 中抽离框架中的东西作为框架的基础功能。用 python 实现一个轻量级的 ORM Build 工具。用 CMake 进行工程组织。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/note/">note</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/">Next</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-center">
    		&copy; 2019 Astone
    	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/require.js/2.1.22/require.min.js"></script>
<script src="/js/main.js"></script>





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  </div>
</body>
</html>